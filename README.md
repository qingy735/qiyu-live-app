# QIYU-LIVE-APP

### 1、高并发场景中的用户中台-数据存储与实战
#### 技术要点
- 数据库设计 
        
  **主从数据库** + **分表**
- 读写分离

    **ShardingJDBC** 实现读写分离
- 分布式缓存Redis
 
    使用 **RedisTemplate** 封装组件、查询引入缓存、批量查询设置随机过期时间防止 **缓存雪崩** 、考虑高并发场景下的缓存一致性问题并基于 **RocketMQ** 实现 **延迟双删**
- 分布式ID生成器

    使用 **本地缓存+MySQL** 实现分布式ID生成器

### 2、高并发场景中的用户中台-用户标签
#### 技术要点
- 标签设计
  用户标签采用位运算进行更新。
  > 增加标签：**newTag = oldTag | addTag** 
  > 
  > 取消标签：**newTag = oldTag &~ delTag**
- 引入Redis缓存

  **查询时机**：判断当前用户是否包含某标签，先从Redis缓存中读取，读取到直接返回，未读取到对userId进行查询，查询为空返回null，不为空更新Redis缓存并返回结果

  **删除缓存**：
  
    增加标签：增加成功才删除缓存，否则不操作

    取消标签：取消成功才删除缓存，否则不操作

      > 数据库优化：
      > 
      > 1、在进行更新标签时，除了userId=#{userId}条件外判断当前标签与新增标签进行与是否为0，为0代表当前标签不包含新增标签，可更新；
      >
      > 2、在进行删除标签时，除了userId=#{userId}条件外判断当前标签与新增标签进行与是否为新增标签本身，是就更新；